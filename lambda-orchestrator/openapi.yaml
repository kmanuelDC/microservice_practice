openapi: 3.1.3
info:
  title: Lambda Orchestrator
  version: 1.0.0
servers:
  - url: http://localhost:3003
components:
  schemas:
    OrchestrateRequest:
      type: object
      required: [customer_id, items, idempotency_key]
      properties:
        customer_id: { type: integer, format: int64 }
        items:
          type: array
          minItems: 1
          items:
            type: object
            required: [product_id, qty]
            properties:
              product_id: { type: integer, format: int64 }
              qty: { type: integer, minimum: 1 }
        idempotency_key: { type: string }
        correlation_id: { type: string }
    OrchestrateResponse:
      type: object
      properties:
        success: { type: boolean }
        correlationId: { type: string }
        data:
          type: object
          properties:
            customer:
              type: object
              description: Customer object returned by Customers /internal
            order:
              type: object
              description: Confirmed order with items
paths:
  /orchestrator/create-and-confirm-order:
    post:
      summary: Validate customer, create order, confirm order (idempotency key), return consolidated JSON
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/OrchestrateRequest' }
      responses:
        '201':
          description: Consolidated result
          content:
            application/json:
              schema: { $ref: '#/components/schemas/OrchestrateResponse' }
        '4XX':
          description: Validation or upstream error
        '5XX':
          description: Internal error
